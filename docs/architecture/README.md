# ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏∞‡∏ö‡∏ö

‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå Muay Thai Next.js + Supabase

## üìã ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°

‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏° **Full-Stack Modern Web Application** ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend      ‚îÇ    ‚îÇ   Backend       ‚îÇ    ‚îÇ   Database      ‚îÇ
‚îÇ   (Next.js)     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (Supabase)    ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (PostgreSQL)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   UI/UX         ‚îÇ    ‚îÇ   API Gateway   ‚îÇ    ‚îÇ   Storage       ‚îÇ
‚îÇ   (Tailwind)    ‚îÇ    ‚îÇ   Auth          ‚îÇ    ‚îÇ   (Supabase)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üèóÔ∏è Technology Stack

### Frontend
- **Framework**: Next.js 15 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **State Management**: React Context + Hooks
- **Forms**: React Hook Form + Zod validation

### Backend
- **BaaS**: Supabase
- **Database**: PostgreSQL
- **Authentication**: Supabase Auth
- **Storage**: Supabase Storage
- **Real-time**: Supabase Realtime

### External Services
- **Payment**: Stripe
- **Email**: Resend
- **Deployment**: Vercel

### Development Tools
- **Testing**: Playwright (E2E)
- **Linting**: ESLint + Prettier
- **Type Checking**: TypeScript
- **Database**: Supabase CLI

## üóÇÔ∏è Project Structure

```
muaythai-next-postgres/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/                     # Next.js App Router
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ (auth)/             # Authentication routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ (dashboard)/        # Dashboard routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/                # API routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ globals.css         # Global styles
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx          # Root layout
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx            # Home page
‚îÇ   ‚îú‚îÄ‚îÄ components/             # Reusable components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/                 # Base UI components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ forms/              # Form components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout/             # Layout components
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ features/           # Feature-specific components
‚îÇ   ‚îú‚îÄ‚îÄ contexts/               # React contexts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthContext.tsx     # Authentication context
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ThemeContext.tsx    # Theme context
‚îÇ   ‚îú‚îÄ‚îÄ lib/                    # Utilities and configurations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ supabase/           # Supabase client and types
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stripe/             # Stripe configuration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validations/        # Zod schemas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.ts            # Utility functions
‚îÇ   ‚îú‚îÄ‚îÄ services/               # API services
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts             # Authentication services
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gyms.ts             # Gym-related services
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bookings.ts         # Booking services
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ payments.ts         # Payment services
‚îÇ   ‚îú‚îÄ‚îÄ types/                  # TypeScript type definitions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.ts         # Database types
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts             # Auth types
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.ts              # API types
‚îÇ   ‚îî‚îÄ‚îÄ middleware.ts           # Next.js middleware
‚îú‚îÄ‚îÄ docs/                       # Documentation
‚îú‚îÄ‚îÄ scripts/                    # Database scripts
‚îú‚îÄ‚îÄ supabase/                   # Supabase configuration
‚îú‚îÄ‚îÄ tests/                      # Test files
‚îî‚îÄ‚îÄ public/                     # Static assets
```

## üîê Authentication & Authorization

### Authentication Flow

```mermaid
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant S as Supabase Auth
    participant D as Database

    U->>F: Login Request
    F->>S: Authenticate
    S->>D: Verify Credentials
    D-->>S: User Data
    S-->>F: JWT Token
    F-->>U: Redirect to Dashboard
```

### Role-Based Access Control (RBAC)

| Role | Permissions | Access Level |
|------|-------------|--------------|
| **User** | - View gyms<br>- Make bookings<br>- Manage own profile | Read: Public data<br>Write: Own data |
| **Partner** | - All User permissions<br>- Manage own gyms<br>- View own bookings<br>- Update gym info | Read: Own gym data<br>Write: Own gym data |
| **Admin** | - All permissions<br>- Manage all users<br>- Manage all gyms<br>- System administration | Read: All data<br>Write: All data |

### Row Level Security (RLS)

```sql
-- Example RLS Policy
CREATE POLICY "Users can view public gym data" ON gyms
    FOR SELECT USING (true);

CREATE POLICY "Partners can manage their own gyms" ON gyms
    FOR ALL USING (auth.uid() = owner_id);

CREATE POLICY "Admins can manage all gyms" ON gyms
    FOR ALL USING (
        EXISTS (
            SELECT 1 FROM user_roles 
            WHERE user_id = auth.uid() 
            AND role = 'admin'
        )
    );
```

## üóÑÔ∏è Database Design

### Core Tables

```mermaid
erDiagram
    users ||--o{ profiles : has
    profiles ||--o{ user_roles : has
    profiles ||--o{ gyms : owns
    gyms ||--o{ gym_packages : contains
    profiles ||--o{ bookings : makes
    gym_packages ||--o{ bookings : booked
    bookings ||--o{ payments : has

    users {
        uuid id PK
        string email
        timestamp created_at
    }

    profiles {
        uuid id PK
        uuid user_id FK
        string username
        string full_name
        string phone
        text bio
        string avatar_url
    }

    user_roles {
        uuid id PK
        uuid user_id FK
        string role
        timestamp created_at
    }

    gyms {
        uuid id PK
        uuid owner_id FK
        string name
        string slug
        text description
        json location
        json images
        boolean is_active
    }

    gym_packages {
        uuid id PK
        uuid gym_id FK
        string name
        text description
        decimal price
        integer duration_days
        json features
    }

    bookings {
        uuid id PK
        uuid user_id FK
        uuid gym_package_id FK
        date start_date
        date end_date
        string status
        decimal total_amount
        string reference_number
    }

    payments {
        uuid id PK
        uuid booking_id FK
        decimal amount
        string currency
        string status
        string stripe_payment_intent_id
        timestamp created_at
    }
```

### Database Functions

```sql
-- Helper Functions
CREATE OR REPLACE FUNCTION is_admin()
RETURNS boolean AS $$
BEGIN
    RETURN EXISTS (
        SELECT 1 FROM user_roles 
        WHERE user_id = auth.uid() 
        AND role = 'admin'
    );
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

CREATE OR REPLACE FUNCTION owns_gym(gym_id uuid)
RETURNS boolean AS $$
BEGIN
    RETURN EXISTS (
        SELECT 1 FROM gyms 
        WHERE id = gym_id 
        AND owner_id = auth.uid()
    );
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

## üîÑ Data Flow

### Booking Flow

```mermaid
flowchart TD
    A[User Browse Gyms] --> B[Select Gym Package]
    B --> C[Fill Booking Form]
    C --> D[Create Booking Record]
    D --> E[Redirect to Payment]
    E --> F[Process Stripe Payment]
    F --> G{Payment Success?}
    G -->|Yes| H[Update Booking Status]
    G -->|No| I[Show Error Message]
    H --> J[Send Confirmation Email]
    J --> K[Redirect to Dashboard]
    I --> E
```

### Admin Management Flow

```mermaid
flowchart TD
    A[Admin Login] --> B[Access Admin Dashboard]
    B --> C{Action Type}
    C -->|User Management| D[Promote/Demote Users]
    C -->|Gym Management| E[Approve/Reject Gyms]
    C -->|Booking Management| F[View All Bookings]
    C -->|System Stats| G[View Analytics]
    D --> H[Update Database]
    E --> H
    F --> H
    G --> H
    H --> I[Refresh Dashboard]
```

## üé® Frontend Architecture

### Component Hierarchy

```
App Layout
‚îú‚îÄ‚îÄ Navigation
‚îÇ   ‚îú‚îÄ‚îÄ Header
‚îÇ   ‚îú‚îÄ‚îÄ UserMenu
‚îÇ   ‚îî‚îÄ‚îÄ MobileMenu
‚îú‚îÄ‚îÄ Main Content
‚îÇ   ‚îú‚îÄ‚îÄ Page Layout
‚îÇ   ‚îú‚îÄ‚îÄ Feature Components
‚îÇ   ‚îî‚îÄ‚îÄ UI Components
‚îî‚îÄ‚îÄ Footer
```

### State Management

```typescript
// Context Pattern
interface AuthContextType {
  user: User | null;
  loading: boolean;
  signIn: (email: string, password: string) => Promise<void>;
  signOut: () => Promise<void>;
  updateProfile: (data: ProfileData) => Promise<void>;
}

// Custom Hooks
function useAuth() {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within AuthProvider');
  }
  return context;
}
```

### API Layer

```typescript
// Service Pattern
class GymService {
  static async getGyms(filters?: GymFilters): Promise<Gym[]> {
    const { data, error } = await supabase
      .from('gyms')
      .select('*, gym_packages(*)')
      .eq('is_active', true);
    
    if (error) throw error;
    return data;
  }

  static async createGym(gymData: CreateGymData): Promise<Gym> {
    const { data, error } = await supabase
      .from('gyms')
      .insert(gymData)
      .select()
      .single();
    
    if (error) throw error;
    return data;
  }
}
```

## üîí Security Architecture

### Security Layers

1. **Frontend Security**
   - Input validation with Zod
   - XSS protection
   - CSRF protection
   - Secure headers

2. **API Security**
   - JWT authentication
   - Rate limiting
   - Input sanitization
   - CORS configuration

3. **Database Security**
   - Row Level Security (RLS)
   - Role-based permissions
   - Encrypted connections
   - Audit logging

### Security Best Practices

```typescript
// Input Validation
const createGymSchema = z.object({
  name: z.string().min(1).max(100),
  description: z.string().max(1000),
  location: z.object({
    address: z.string().min(1),
    lat: z.number(),
    lng: z.number(),
  }),
});

// Sanitization
function sanitizeInput(input: string): string {
  return input.trim().replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
}

// Authorization Check
async function requireAdmin(req: NextRequest) {
  const user = await getUser(req);
  if (!user || !await isAdmin(user.id)) {
    throw new Error('Unauthorized');
  }
}
```

## üìä Performance Architecture

### Optimization Strategies

1. **Frontend Optimization**
   - Next.js App Router for optimal loading
   - Image optimization with next/image
   - Code splitting and lazy loading
   - Caching strategies

2. **Database Optimization**
   - Proper indexing
   - Query optimization
   - Connection pooling
   - Read replicas (future)

3. **API Optimization**
   - Response caching
   - Pagination
   - Data prefetching
   - Compression

### Monitoring & Analytics

```typescript
// Performance Monitoring
export function trackPageView(page: string) {
  if (typeof window !== 'undefined') {
    // Analytics tracking
    gtag('config', GA_TRACKING_ID, {
      page_title: page,
      page_location: window.location.href,
    });
  }
}

// Error Tracking
export function trackError(error: Error, context?: string) {
  console.error('Application Error:', error, context);
  // Send to error tracking service
}
```

## üöÄ Deployment Architecture

### Environment Strategy

```
Development ‚Üí Staging ‚Üí Production
     ‚Üì           ‚Üì         ‚Üì
Local Supabase ‚Üí Staging DB ‚Üí Production DB
     ‚Üì           ‚Üì         ‚Üì
Local Server ‚Üí Vercel Preview ‚Üí Vercel Production
```

### CI/CD Pipeline

```yaml
# Simplified CI/CD Flow
Build ‚Üí Test ‚Üí Deploy
  ‚Üì      ‚Üì      ‚Üì
TypeScript ‚Üí E2E Tests ‚Üí Vercel
ESLint ‚Üí Unit Tests ‚Üí Database Migration
Prettier ‚Üí Integration Tests ‚Üí Environment Config
```

## üîÑ Scalability Considerations

### Current Architecture Limits
- Single database instance
- Monolithic frontend
- Limited caching

### Future Scalability Plans
1. **Database Scaling**
   - Read replicas
   - Database sharding
   - Caching layer (Redis)

2. **Frontend Scaling**
   - Micro-frontends
   - CDN optimization
   - Edge computing

3. **API Scaling**
   - Microservices architecture
   - API Gateway
   - Load balancing

## üìö Documentation Standards

### Code Documentation
- TypeScript interfaces for all data structures
- JSDoc comments for complex functions
- README files for each major directory
- Architecture Decision Records (ADRs)

### API Documentation
- OpenAPI/Swagger specifications
- Example requests and responses
- Error code documentation
- Rate limiting information

## ü§ù Development Workflow

### Git Workflow
```
main (production)
‚îú‚îÄ‚îÄ develop (staging)
‚îÇ   ‚îú‚îÄ‚îÄ feature/user-authentication
‚îÇ   ‚îú‚îÄ‚îÄ feature/gym-management
‚îÇ   ‚îî‚îÄ‚îÄ hotfix/payment-bug
‚îî‚îÄ‚îÄ release/v1.2.0
```

### Code Review Process
1. Feature branch creation
2. Development and testing
3. Pull request creation
4. Code review and approval
5. Merge to develop
6. Staging deployment and testing
7. Merge to main
8. Production deployment

## üìû Support & Maintenance

### Monitoring
- Application performance monitoring
- Database performance monitoring
- Error tracking and alerting
- User analytics

### Maintenance Tasks
- Regular database backups
- Security updates
- Performance optimization
- Feature updates and bug fixes

---

‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ï‡∏±‡∏ß ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏°‡∏±‡∏¢‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î