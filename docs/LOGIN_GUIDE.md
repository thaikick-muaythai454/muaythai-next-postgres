# üîê ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£ Login

**‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î**: 2025-11-06

---

## üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£ Login ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö

### 1. **Email + Password** ‚úÖ
- ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ **‡∏≠‡∏µ‡πÄ‡∏°‡∏•** ‡πÅ‡∏•‡∏∞ **‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô**
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: `user@example.com`

### 2. **Username + Password** ‚úÖ
- ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ **Username** ‡πÅ‡∏•‡∏∞ **‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô**
- ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ email ‡∏à‡∏≤‡∏Å username ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: `myusername`

### 3. **Google OAuth** ‚úÖ
- ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ **Google Account**
- ‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° "Sign in with Google" ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ login
- ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á account ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ

---

## üë• User Roles (‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)

### 1. **Regular User** (‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)
- ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á: `/dashboard`
- ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå:
  - ‡∏î‡∏π‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
  - ‡∏à‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡∏¢‡∏°‡∏ß‡∏¢
  - ‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏ï‡∏±‡πã‡∏ß‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå
  - ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á/‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠
  - ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö Affiliate
  - ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö Gamification

### 2. **Partner** (‡∏Ñ‡∏π‡πà‡∏Ñ‡πâ‡∏≤)
- ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á: `/partner/dashboard`
- ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå:
  - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏¥‡∏°
  - ‡∏î‡∏π‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
  - ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ/‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
  - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à
  - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô

### 3. **Admin** (‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö)
- ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á: `/admin/dashboard`
- ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå:
  - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  - ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏¢‡∏¥‡∏°
  - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå
  - ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
  - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

---

## üß™ Test Users (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö)

### ‚ö†Ô∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
Test users ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `tests/e2e/login-existing-users.spec.ts` ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á Test Users:

1. **‡∏£‡∏±‡∏ô E2E Test ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á users ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥**:
   ```bash
   npm run test:e2e tests/e2e/auth-flow.spec.ts
   ```
   - ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á test users 3 ‡∏Ñ‡∏ô (regular, partner, admin)
   - ‡∏î‡∏π email ‡πÅ‡∏•‡∏∞ password ‡πÉ‡∏ô console output

2. **‡∏™‡∏£‡πâ‡∏≤‡∏á Test User ‡∏î‡πâ‡∏ß‡∏¢ Script**:
   ```bash
   node scripts/node/create-user.js
   ```

3. **‡∏™‡∏£‡πâ‡∏≤‡∏á Test User ‡∏î‡πâ‡∏ß‡∏¢ Admin API**:
   ```bash
   npm run test:scripts:admin
   ```

---

## üìù ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£ Login

### Login ‡∏î‡πâ‡∏ß‡∏¢ Email:
```
Email: user@example.com
Password: YourPassword123!
```

### Login ‡∏î‡πâ‡∏ß‡∏¢ Username:
```
Username: myusername
Password: YourPassword123!
```

### Login ‡∏î‡πâ‡∏ß‡∏¢ Google:
1. ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° "Sign in with Google"
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Google Account
3. ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á
4. ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞ redirect ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

---

## üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö User ‡∏ó‡∏µ‡πà Login ‡∏≠‡∏¢‡∏π‡πà

### ‡πÉ‡∏ô Browser Console:
```javascript
// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö session
const { data: { session } } = await supabase.auth.getSession();
console.log('Current user:', session?.user);

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö role
const { data: role } = await supabase
  .from('user_roles')
  .select('role')
  .eq('user_id', session.user.id)
  .single();
console.log('User role:', role?.role);
```

### ‡πÉ‡∏ô Database:
```sql
-- ‡∏î‡∏π users ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
SELECT id, email, created_at FROM auth.users;

-- ‡∏î‡∏π roles
SELECT u.email, ur.role 
FROM auth.users u
LEFT JOIN user_roles ur ON ur.user_id = u.id;
```

---

## üõ†Ô∏è Troubleshooting

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö"
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ email/username ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£ signup ‡πÅ‡∏•‡πâ‡∏ß
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ verify ‡πÅ‡∏•‡πâ‡∏ß

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: "‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (case-sensitive)
- ‡∏•‡∏≠‡∏á reset password

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: "Session ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏"
- Logout ‡πÅ‡∏•‡∏∞ login ‡πÉ‡∏´‡∏°‡πà
- ‡∏•‡∏ö cookies ‡πÅ‡∏•‡∏∞ cache

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: "‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå"
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ role ‡πÉ‡∏ô `user_roles` table
- ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ admin ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå

---

## üìö API Endpoints

### Login API:
- **POST** `/api/auth/login` (internal, ‡πÉ‡∏ä‡πâ Supabase client)

### User Info:
- **GET** `/api/users` - ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• user ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

### OAuth:
- **GET** `/auth/callback` - Handle OAuth callback

---

## üîê Security Notes

1. **Password Requirements**:
   - ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
   - ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏ç‡πà, ‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å, ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç, ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞‡∏û‡∏¥‡πÄ‡∏®‡∏©

2. **Session Management**:
   - Session ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô httpOnly cookies
   - Auto-refresh token
   - Session timeout: ‡∏ï‡∏≤‡∏° Supabase settings

3. **OAuth Security**:
   - ‡πÉ‡∏ä‡πâ secure redirect URIs
   - Validate state parameter
   - Verify email domain (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)

---

## üìñ Related Documentation

- [Authentication System](../PROGRESS_REPORT.md#authentication)
- [User Roles](../PROGRESS_REPORT.md#role-based-access-control)
- [Testing Guide](../TESTING_CHECKLIST.md)

