# ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå Muay Thai Next.js + Supabase

## üìã ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°

‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏° ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢:
- **E2E Testing** ‡∏î‡πâ‡∏ß‡∏¢ Playwright
- **Script Validation Tests** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö database scripts
- **Unit Tests** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö components ‡πÅ‡∏•‡∏∞ utilities

## üß™ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### 1. E2E Testing (Playwright)
‡∏ó‡∏î‡∏™‡∏≠‡∏ö user flow ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ú‡πà‡∏≤‡∏ô browser ‡∏à‡∏£‡∏¥‡∏á

**‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°:**
- ‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
- ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏à‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡∏¢‡∏°‡∏ß‡∏¢
- ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
- Dashboard ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin ‡πÅ‡∏•‡∏∞ Partner
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏¢‡∏°‡∏ß‡∏¢

### 2. Script Validation Tests
‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á database scripts

**‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°:**
- Admin management functions
- Database utilities
- Development setup scripts
- Storage configuration

### 3. Component Tests (‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
‡∏ó‡∏î‡∏™‡∏≠‡∏ö React components ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß

## üöÄ ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡πÄ‡∏ó‡∏™

### E2E Tests

```bash
# ‡∏£‡∏±‡∏ô‡πÄ‡∏ó‡∏™‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (headless)
npm run test:e2e

# ‡∏£‡∏±‡∏ô‡πÄ‡∏ó‡∏™‡∏û‡∏£‡πâ‡∏≠‡∏° UI
npm run test:e2e:ui

# ‡∏£‡∏±‡∏ô‡πÄ‡∏ó‡∏™‡πÅ‡∏ö‡∏ö debug
npm run test:e2e:debug

# ‡∏£‡∏±‡∏ô‡πÄ‡∏ó‡∏™‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå
npx playwright test auth.spec.ts

# ‡∏£‡∏±‡∏ô‡πÄ‡∏ó‡∏™‡πÉ‡∏ô browser ‡πÄ‡∏â‡∏û‡∏≤‡∏∞
npx playwright test --project=chromium
```

### Script Validation Tests

```bash
# ‡∏£‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö scripts ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
node tests/scripts/run-all-tests.js

# ‡∏£‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô
node tests/scripts/run-all-tests.js --admin
node tests/scripts/run-all-tests.js --database
node tests/scripts/run-all-tests.js --setup
node tests/scripts/run-all-tests.js --storage

# ‡∏£‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö verbose
node tests/scripts/run-all-tests.js --verbose
```

## üìÅ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö

```
tests/
‚îú‚îÄ‚îÄ e2e/                          # E2E tests (Playwright)
‚îÇ   ‚îú‚îÄ‚îÄ auth.spec.ts             # ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö authentication
‚îÇ   ‚îú‚îÄ‚îÄ booking.spec.ts          # ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á
‚îÇ   ‚îú‚îÄ‚îÄ admin.spec.ts            # ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö admin dashboard
‚îÇ   ‚îú‚îÄ‚îÄ partner.spec.ts          # ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö partner dashboard
‚îÇ   ‚îî‚îÄ‚îÄ utils/                   # Test utilities
‚îú‚îÄ‚îÄ scripts/                     # Script validation tests
‚îÇ   ‚îú‚îÄ‚îÄ admin-management.test.js
‚îÇ   ‚îú‚îÄ‚îÄ database-utilities.test.js
‚îÇ   ‚îú‚îÄ‚îÄ development-setup.test.js
‚îÇ   ‚îú‚îÄ‚îÄ storage-configuration.test.js
‚îÇ   ‚îú‚îÄ‚îÄ run-all-tests.js
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ unit/                        # Unit tests (‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
    ‚îú‚îÄ‚îÄ components/
    ‚îú‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ services/
```

## ‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### Environment Variables ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

```env
# .env.test
NEXT_PUBLIC_SUPABASE_URL=http://127.0.0.1:54321
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_local_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_local_service_key

# Test user credentials
TEST_ADMIN_EMAIL=admin@muaythai.com
TEST_ADMIN_PASSWORD=password123
TEST_USER_EMAIL=user@muaythai.com
TEST_USER_PASSWORD=password123
```

### Playwright Configuration

```typescript
// playwright.config.ts
export default defineConfig({
  testDir: './tests/e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: 'http://localhost:3000',
    trace: 'on-first-retry',
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
    },
  ],
  webServer: {
    command: 'npm run dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
  },
});
```

## üìù ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏ó‡∏™

### E2E Test Example

```typescript
// tests/e2e/auth.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Authentication', () => {
  test('should login successfully', async ({ page }) => {
    await page.goto('/login');
    
    await page.fill('[data-testid="email"]', 'admin@muaythai.com');
    await page.fill('[data-testid="password"]', 'password123');
    await page.click('[data-testid="login-button"]');
    
    await expect(page).toHaveURL('/dashboard');
    await expect(page.locator('[data-testid="user-menu"]')).toBeVisible();
  });

  test('should show error for invalid credentials', async ({ page }) => {
    await page.goto('/login');
    
    await page.fill('[data-testid="email"]', 'invalid@email.com');
    await page.fill('[data-testid="password"]', 'wrongpassword');
    await page.click('[data-testid="login-button"]');
    
    await expect(page.locator('[data-testid="error-message"]')).toBeVisible();
  });
});
```

### Script Validation Test Example

```javascript
// tests/scripts/admin-management.test.js
import { createClient } from '@supabase/supabase-js';

const supabase = createClient(
  process.env.SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY
);

export async function testAdminPromotion() {
  console.log('üß™ Testing admin promotion...');
  
  try {
    // Test promoting user to admin
    const { data, error } = await supabase
      .rpc('promote_to_admin', { email: 'test@example.com' });
    
    if (error) throw error;
    
    console.log('‚úÖ Admin promotion test passed');
    return true;
  } catch (error) {
    console.log('‚ùå Admin promotion test failed:', error.message);
    return false;
  }
}
```

## üîß Test Data Management

### Test Users

‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏™‡∏£‡πâ‡∏≤‡∏á test users ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ú‡πà‡∏≤‡∏ô development setup:

```bash
./scripts/development-setup.sh --users-only
```

**Test Users ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á:**
- `admin@muaythai.com` / `password123` (Admin)
- `user@muaythai.com` / `password123` (User)
- `partner@muaythai.com` / `password123` (Partner)
- `partner2@muaythai.com` / `password123` (Partner)

### Test Data Cleanup

```typescript
// tests/utils/cleanup.ts
export async function cleanupTestData() {
  // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏±‡∏ô‡πÄ‡∏ó‡∏™
  await supabase.from('bookings').delete().eq('user_id', testUserId);
  await supabase.from('gyms').delete().eq('owner_id', testUserId);
}
```

## üìä Test Reports

### Playwright Reports

```bash
# ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML report
npx playwright test --reporter=html

# ‡πÄ‡∏õ‡∏¥‡∏î report
npx playwright show-report
```

### Script Validation Reports

```bash
# ‡∏£‡∏±‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏° verbose output
node tests/scripts/run-all-tests.js --verbose > test-report.log
```

## üö® Troubleshooting

### Common Issues

1. **Tests ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß‡πÄ‡∏û‡∏£‡∏≤‡∏∞ timeout**
   ```typescript
   // ‡πÄ‡∏û‡∏¥‡πà‡∏° timeout ‡πÉ‡∏ô test
   test('slow test', async ({ page }) => {
     test.setTimeout(60000); // 60 seconds
     // test code...
   });
   ```

2. **Database connection issues**
   ```bash
   # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Supabase local
   supabase status
   
   # ‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó Supabase
   supabase stop && supabase start
   ```

3. **Test data conflicts**
   ```typescript
   // ‡πÉ‡∏ä‡πâ unique identifiers
   const testEmail = `test-${Date.now()}@example.com`;
   ```

4. **Browser issues**
   ```bash
   # ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á browsers ‡πÉ‡∏´‡∏°‡πà
   npx playwright install
   
   # ‡∏£‡∏±‡∏ô‡πÉ‡∏ô headed mode ‡πÄ‡∏û‡∏∑‡πà‡∏≠ debug
   npx playwright test --headed
   ```

### Debug Commands

```bash
# Debug E2E tests
npx playwright test --debug

# Debug script tests
node tests/scripts/admin-management.test.js

# Check test environment
./scripts/development-setup.sh --check-only

# Validate database for testing
node scripts/database-utilities.js check
```

## üîÑ CI/CD Integration

### GitHub Actions Example

```yaml
# .github/workflows/test.yml
name: Tests
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Start Supabase
        run: |
          npm install -g supabase
          supabase start
      
      - name: Run script validation tests
        run: node tests/scripts/run-all-tests.js
        env:
          SUPABASE_URL: http://127.0.0.1:54321
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
      
      - name: Install Playwright
        run: npx playwright install --with-deps
      
      - name: Run E2E tests
        run: npm run test:e2e
      
      - name: Upload test results
        uses: actions/upload-artifact@v3
        if: always()
        with:
          name: playwright-report
          path: playwright-report/
```

## üìö Best Practices

### 1. Test Organization
- ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏ó‡∏™‡∏ï‡∏≤‡∏° feature
- ‡πÉ‡∏ä‡πâ descriptive test names
- ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô test documentation

### 2. Test Data
- ‡πÉ‡∏ä‡πâ unique identifiers
- ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ó‡∏™
- ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤ external data

### 3. Assertions
- ‡πÉ‡∏ä‡πâ specific assertions
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á positive ‡πÅ‡∏•‡∏∞ negative cases
- ‡∏£‡∏≠‡πÉ‡∏´‡πâ elements ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô assert

### 4. Maintenance
- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏ó‡∏™‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á feature
- ‡∏£‡∏±‡∏ô‡πÄ‡∏ó‡∏™‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥
- ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° test coverage

## üìû Support

‡∏´‡∏≤‡∏Å‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö:

1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö [Troubleshooting](#troubleshooting) ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
2. ‡∏î‡∏π [Script Tests Documentation](../../tests/scripts/README.md)
3. ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: `./scripts/development-setup.sh --check-only`
4. ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° error ‡πÅ‡∏•‡∏∞ test logs